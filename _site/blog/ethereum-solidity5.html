<!doctype html>

<html class="no-js" lang="en">

<head>


	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Try

	Index Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/icon.png">
	<title>Ethereum Smart Contracts and Solidity -5- – Try</title>
	<meta name="description" content="">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Ethereum Smart Contracts and Solidity -5- – Try">
	<meta name="twitter:description" content="">
	<meta name="twitter:image:src" content="">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="Ethereum Smart Contracts and Solidity -5- – Try" />
	<meta property="og:description" content="" />
	<meta property="og:image" content="" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,500" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/blog/ethereum-solidity5">


	<header class="header">

	<div class="header__content">

		
		<a href="/" class="header__title">
			Try
		</a>
		

		<h1 class="header__tagline">The man who moves a mountain begins by carrying away small stones. - Confucius</h1>

		<div class="menu">
			<div class="menu__toggle js-menu-toggle">
				<div class="menu__toggle__icon"><span></span></div>
			</div>
			<div class="menu__wrap">
				<ul class="menu__list">
					
					<li class="menu__list__item">
						<a href="/about" class="menu__list__item__link">About</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/apache" class="menu__list__item__link">Apache</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/blockchain" class="menu__list__item__link">BlockChain</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/computerscience" class="menu__list__item__link">Computer Science</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/database" class="menu__list__item__link">DataBase</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/devops" class="menu__list__item__link">DevOps</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/imageprocessing" class="menu__list__item__link">Image Processing</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/machinelearning" class="menu__list__item__link">Machine Learning</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/programming" class="menu__list__item__link">Programming</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/softwaremaestro" class="menu__list__item__link">SW Maestro</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/web" class="menu__list__item__link">Web</a>
					</li>
					
				</ul>
			</div>
		</div>

		<div class="projects-menu">
			<ul class="menu__list">
				
			</ul>
		</div>

		<div class="header__lower">

			<ul class="socials">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/has3ong" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/%ED%95%98%EC%84%B1-%EA%B9%80-145aa21a0/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

			<div class="footer__copyright">
				<span>© 2020 Try</span>
				Has3ong
			</div>

		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="Ethereum Smart Contracts and Solidity -5- – Try">

			<section class="intro">

	<div class="wrap">

		<h1>Ethereum Smart Contracts and Solidity -5-</h1>
		<p>20 January 2020</p>

	</div>

</section>

<section class="single">

	<div class="wrap">

		<h3 id="function-modifiers">Function Modifiers</h3>

<p>솔리디티에서는 <strong>함수 변경자(function modifier)</strong> 라 불리는 함수를 제공합니다. 함수 선언에 <code class="highlighter-rouge">modifier</code> 라는 이름을 추가하여 적용합니다. 변경자는 컨트랙트 내에서 함수에 적용되어야 할 여러 조건을 생성하기위해 자주 사용됩니다. 아래는 예시입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">modifier</span> <span class="n">onlyOwner</span> <span class="o">{</span>
    <span class="n">require</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="o">);</span>
    <span class="n">_</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>컨트랙트의 owner 로 저장된 주소가 트랜잭션의 <code class="highlighter-rouge">msg.sender</code> 주소가 동일해야 합니다. 오직 컨트랙트 소유자만 <code class="highlighter-rouge">onlyOwner</code> 변경자를 가진 모든 함수를 실행할 수 있게 해줍니다.</p>

<p>함수 변경자는 안에 <strong>표시자(placeholder)</strong> 가 있고 밑줄 뒤에 세미콜린이 따라옵니다. 이 표시는 수정되는 함수의 코드로 대체됩니다. 기본적으로 변경자는 변경된 함수 주변을 둘러쌉니다. 밑줄 문자로 식별된 위치에 코드가 삽입됩니다.</p>

<p>변경자를 적용하려면 함수 선언에 변경자 이름을 추가합니다. 함수에 둘 이상의 변경자를 적용할 수 있습니다.</p>

<p><code class="highlighter-rouge">onlyOwner</code> 변경자를 사용하여 <code class="highlighter-rouge">destroy</code> 함수를 작성해보겠습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">public</span> <span class="n">onlyOwner</span> <span class="o">{</span>
    <span class="n">selfdestruct</span><span class="o">(</span><span class="n">owner</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">destroy</code> 함수가 <code class="highlighter-rouge">onlyOwner</code> 변경자에 의해 한정되는것을 알 수 있습니다. 실제 결과 코드는 <code class="highlighter-rouge">onlyOwner</code> 가 <code class="highlighter-rouge">destroy</code> 함수를 감싸고 있는 <strong>wrapping</strong> 코드와 같습니다.</p>

<h3 id="contract-inheritance">Contract Inheritance</h3>

<p>상속을 사용하기 위해선 부모 컨트랙트에 <code class="highlighter-rouge">is</code> 키워드를 사용하면 됩니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="nc">Child</span> <span class="n">is</span> <span class="nc">Parent</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 구조는 <code class="highlighter-rouge">Child</code> 컨트랙트가 <code class="highlighter-rouge">Parent</code> 의 모든 메소드, 변수, 기능을 상속한다는 의미입니다. 솔리디티에서는 다중 상속도 지원합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="nc">Child</span> <span class="n">is</span> <span class="nc">Parent1</span><span class="o">,</span> <span class="nc">Parent2</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>컨트랙트 상속을 통해서 모듈성, 확장성, 재사용을 달성할 수 있는 방법으로 컨트랙트를 작성할 수 있습니다. 단순하고 일반적인 기능을 구현한 컨트랙트를 시작한 다음 전문화된 컨트랙트로 기능을 상속하여 확장시킬 수 있습니다.</p>

<p><code class="highlighter-rouge">owner</code> 변수가 있는 <code class="highlighter-rouge">owned</code> 컨트랙트를 정의하고 컨트랙트의 생성자에서 <code class="highlighter-rouge">owner</code> 를 설정합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="n">owned</span> <span class="o">{</span>
	<span class="n">address</span> <span class="n">owner</span><span class="o">;</span>

	<span class="c1">// Contract constructor: set owner</span>
	<span class="n">constructor</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">// Access control modifier</span>
	<span class="n">modifier</span> <span class="n">onlyOwner</span> <span class="o">{</span>
	    <span class="n">require</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="o">);</span>
	    <span class="n">_</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">owned</code> 를 상속한 기본 컨트랙트인 <code class="highlighter-rouge">mortal</code> 을 정의합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="n">mortal</span> <span class="n">is</span> <span class="n">owned</span> <span class="o">{</span>
	<span class="c1">// Contract destructor</span>
	<span class="n">function</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">public</span> <span class="n">onlyOwner</span> <span class="o">{</span>
		<span class="n">selfdestruct</span><span class="o">(</span><span class="n">owner</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="nc">Faucet</span> <span class="n">is</span> <span class="n">mortal</span> <span class="o">{</span>
    <span class="c1">// Give out ether to anyone who asks</span>
    <span class="n">function</span> <span class="nf">withdraw</span><span class="o">(</span><span class="n">uint</span> <span class="n">withdraw_amount</span><span class="o">)</span> <span class="kd">public</span> <span class="o">{</span>
        <span class="c1">// Limit withdrawal amount</span>
        <span class="n">require</span><span class="o">(</span><span class="n">withdraw_amount</span> <span class="o">&lt;=</span> <span class="mf">0.1</span> <span class="n">ether</span><span class="o">);</span>
        <span class="c1">// Send the amount to the address that requested it</span>
        <span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="n">withdraw_amount</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// Accept any incoming amount</span>
    <span class="n">function</span> <span class="o">()</span> <span class="kd">public</span> <span class="n">payable</span> <span class="o">{}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">owned</code> 를 상속받은 <code class="highlighter-rouge">mortal</code> 을 상속받아서 <strong>Faucet</strong> 컨트랙트는 생성자와 <code class="highlighter-rouge">destroy</code> 함수 그리고 소유자가 정의한 것들을 가질 수 있습니다.</p>

<h3 id="error-handling-assert-require-revert">Error Handling (assert, require, revert)</h3>

<p>컨트랙트 호출은 중단되고 에러를 반환할 수 있습니다. 솔리디티에서는 에러 제어를 <code class="highlighter-rouge">assert</code>, <code class="highlighter-rouge">require</code>, <code class="highlighter-rouge">revert</code>, <code class="highlighter-rouge">throw</code> 4 가지 함수를 사용합니다.</p>

<p>에러로 스마트 컨트랙트가 중지될 때는 둘 이상의 컨트랙트가 호출된 경우 컨트랙트 호출 연결을 따라 모든 상태가 원래대로 되돌려집니다. 왜냐하면, 트랜잭션들이 <strong>원자성(atomic)</strong> 을 보장해야 하기 때문입니다.</p>

<p><code class="highlighter-rouge">assert</code> 와 <code class="highlighter-rouge">require</code> 함수도 조건을 평가하고, 조건이 거짓이면 에러로 실행을 중지시키는 동일한 방식으로 동작합니다. 통상적으로 <code class="highlighter-rouge">assert</code> 는 결과가 참일 것으로 예상될 때 사용하는데, 이것은 내적인 조건이 만족되는지 테스트를 하는 의미입니다. 이에 비해 <code class="highlighter-rouge">require</code> 는 입력값이 설정한 조건의 기댓값에 맞는지 테스트할 때 사용합니다.</p>

<p>메세지 발신자가 컨트랙트의 소유자임을 테스트하기 위해 함수 변경자 <code class="highlighter-rouge">onlyOwner</code> 에서 <code class="highlighter-rouge">require</code> 를 사용합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">require</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">require</code> 함수는 요구되는 조건이 만족되지 않을 경우 에러를 발생시켜 함수의 나머지 부분이 실행되지 않도록 하는 <strong>게이트 조건(gate condition)</strong> 기능을 합니다. 또한, 아래와 같이 <code class="highlighter-rouge">require</code> 함수에 에러 메세지를 추가함으로써 코드를 개선할 수 있습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">require</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="o">,</span> <span class="s">"Only the contract owner can call this function"</span><span class="o">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">revert</code> 와 <code class="highlighter-rouge">throw</code> 함수는 컨트랙트의 실행을 중지하고 모든 변경상태를 되돌립니다. <code class="highlighter-rouge">throw</code> 함수는 제거될 예정이라 <code class="highlighter-rouge">revert</code> 를 사용합니다. <code class="highlighter-rouge">revert</code> 함수는 다른 변수 없이 에러 메세지만을 인수로 사용할 수 있는데, 이 메세지는 트랜잭션 로그에 기록됩니다.</p>

<p>앞선 예제에서는 출금 요청을 할 때 이더가 충분한지 여부를 명시적으로 확인하지 않습니다. 그 이유는 <code class="highlighter-rouge">transfer</code> 함수에서 이더가 충분하지 않으면 에러를 내고 트랜잭션을 되돌릴 것이기 때문입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="n">withdraw_amount</span><span class="o">);</span>
</code></pre></div></div>

<p>하지만 아래와같이 실패시 에러 메세지를 명시적으로 확인하는것이 좋습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">require</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">balance</span> <span class="o">&gt;=</span> <span class="n">withdraw_amount</span><span class="o">,</span>
	<span class="s">"Insufficient balance in faucet for withdrawal request"</span><span class="o">);</span>
<span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="n">withdraw_amount</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="event">Event</h3>

<p>트랜잭션이 완료되면 <strong>트랜잭션 영수증(transaction receipt)</strong> 를 발행합니다. 트랜잭션 영수증은 트랜잭션의 실행 동안 발생했던 행위에 관한 정보를 제공하는 <strong>로그(log)</strong> 를 가지고 있습니다. 이벤트는 이러한 로그를 만들기 위해 사용하는 솔리디티의 고수준 객체 입니다.</p>

<p>앞선 예제에 이벤트를 추가하지 않았으므로 <strong>출금(withdrawal)</strong> 과 <strong>입금(deposit)</strong> 을 해보겠습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">contract</span> <span class="nc">Faucet</span> <span class="n">is</span> <span class="n">mortal</span> <span class="o">{</span>
	<span class="n">event</span> <span class="nf">Withdrawal</span><span class="o">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">to</span><span class="o">,</span> <span class="n">uint</span> <span class="n">amount</span><span class="o">);</span>
	<span class="n">event</span> <span class="nf">Deposit</span><span class="o">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">from</span><span class="o">,</span> <span class="n">uint</span> <span class="n">amount</span><span class="o">);</span>

	<span class="o">[...]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>다음은 트랜잭션 로그에 이벤트 데이터를 넣기 위해서 <code class="highlighter-rouge">emit</code> 키워드를 사용합니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Give out ether to anyone who asks</span>
<span class="n">function</span> <span class="nf">withdraw</span><span class="o">(</span><span class="n">uint</span> <span class="n">withdraw_amount</span><span class="o">)</span> <span class="kd">public</span> <span class="o">{</span>
    <span class="o">[...]</span>
    <span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="n">withdraw_amount</span><span class="o">);</span>
    <span class="n">emit</span> <span class="nf">Withdrawal</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">,</span> <span class="n">withdraw_amount</span><span class="o">);</span>
<span class="o">}</span>
<span class="c1">// Accept any incoming amount</span>
<span class="n">function</span> <span class="o">()</span> <span class="kd">public</span> <span class="n">payable</span> <span class="o">{</span>
    <span class="n">emit</span> <span class="nf">Deposit</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">,</span> <span class="n">msg</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이벤트를 추가하여 만든 결과는 다음과 같습니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Version of Solidity compiler this program was written for</span>
<span class="n">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="o">.</span><span class="mi">22</span><span class="o">;</span>

<span class="n">contract</span> <span class="n">owned</span> <span class="o">{</span>
	<span class="n">address</span> <span class="n">owner</span><span class="o">;</span>
	<span class="c1">// Contract constructor: set owner</span>
	<span class="n">constructor</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">owner</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">// Access control modifier</span>
	<span class="n">modifier</span> <span class="n">onlyOwner</span> <span class="o">{</span>
		<span class="n">require</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="o">,</span>
		        <span class="s">"Only the contract owner can call this function"</span><span class="o">);</span>
		<span class="n">_</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">contract</span> <span class="n">mortal</span> <span class="n">is</span> <span class="n">owned</span> <span class="o">{</span>
	<span class="c1">// Contract destructor</span>
	<span class="n">function</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">public</span> <span class="n">onlyOwner</span> <span class="o">{</span>
		<span class="n">selfdestruct</span><span class="o">(</span><span class="n">owner</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="n">contract</span> <span class="nc">Faucet</span> <span class="n">is</span> <span class="n">mortal</span> <span class="o">{</span>
	<span class="n">event</span> <span class="nf">Withdrawal</span><span class="o">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">to</span><span class="o">,</span> <span class="n">uint</span> <span class="n">amount</span><span class="o">);</span>
	<span class="n">event</span> <span class="nf">Deposit</span><span class="o">(</span><span class="n">address</span> <span class="n">indexed</span> <span class="n">from</span><span class="o">,</span> <span class="n">uint</span> <span class="n">amount</span><span class="o">);</span>

	<span class="c1">// Give out ether to anyone who asks</span>
	<span class="n">function</span> <span class="nf">withdraw</span><span class="o">(</span><span class="n">uint</span> <span class="n">withdraw_amount</span><span class="o">)</span> <span class="kd">public</span> <span class="o">{</span>
		<span class="c1">// Limit withdrawal amount</span>
		<span class="n">require</span><span class="o">(</span><span class="n">withdraw_amount</span> <span class="o">&lt;=</span> <span class="mf">0.1</span> <span class="n">ether</span><span class="o">);</span>
		<span class="n">require</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">balance</span> <span class="o">&gt;=</span> <span class="n">withdraw_amount</span><span class="o">,</span>
			<span class="s">"Insufficient balance in faucet for withdrawal request"</span><span class="o">);</span>
		<span class="c1">// Send the amount to the address that requested it</span>
		<span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">.</span><span class="na">transfer</span><span class="o">(</span><span class="n">withdraw_amount</span><span class="o">);</span>
		<span class="n">emit</span> <span class="nf">Withdrawal</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">,</span> <span class="n">withdraw_amount</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="c1">// Accept any incoming amount</span>
	<span class="n">function</span> <span class="o">()</span> <span class="n">external</span> <span class="n">payable</span> <span class="o">{</span>
		<span class="n">emit</span> <span class="nf">Deposit</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">sender</span><span class="o">,</span> <span class="n">msg</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="catching-events">Catching events</h3>

<p><code class="highlighter-rouge">truffle</code> 을 사용하여 Faucet 컨트랙트에 대한 테스트 트랜잭션을 실행해보겠습니다. 코드의 주소는 <a href="https://github.com/ethereumbook/ethereumbook/tree/develop/code/truffle/FaucetEvents">[Github]</a> 에 있습니다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>truffle develop
truffle<span class="o">(</span>develop<span class="o">)&gt;</span> compile
truffle<span class="o">(</span>develop<span class="o">)&gt;</span> migrate
Using network <span class="s1">'develop'</span><span class="nb">.</span>

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle<span class="o">(</span>develop<span class="o">)&gt;</span> Faucet.deployed<span class="o">()</span>.then<span class="o">(</span>i <span class="o">=&gt;</span> <span class="o">{</span>FaucetDeployed <span class="o">=</span> i<span class="o">})</span>
truffle<span class="o">(</span>develop<span class="o">)&gt;</span> FaucetDeployed.send<span class="o">(</span>web3.toWei<span class="o">(</span>1, <span class="s2">"ether"</span><span class="o">))</span>.then<span class="o">(</span>res <span class="o">=&gt;</span> <span class="se">\</span>
                  <span class="o">{</span> console.log<span class="o">(</span>res.logs[0].event, res.logs[0].args<span class="o">)</span> <span class="o">})</span>
Deposit <span class="o">{</span> from: <span class="s1">'0x627306090abab3a6e1400e9345bc60c78a8bef57'</span>,
  amount: BigNumber <span class="o">{</span> s: 1, e: 18, c: <span class="o">[</span> 10000 <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
truffle<span class="o">(</span>develop<span class="o">)&gt;</span> FaucetDeployed.withdraw<span class="o">(</span>web3.toWei<span class="o">(</span>0.1, <span class="s2">"ether"</span><span class="o">))</span>.then<span class="o">(</span>res <span class="o">=&gt;</span> <span class="se">\</span>
                  <span class="o">{</span> console.log<span class="o">(</span>res.logs[0].event, res.logs[0].args<span class="o">)</span> <span class="o">})</span>
Withdrawal <span class="o">{</span> to: <span class="s1">'0x627306090abab3a6e1400e9345bc60c78a8bef57'</span>,
  amount: BigNumber <span class="o">{</span> s: 1, e: 17, c: <span class="o">[</span> 1000 <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">deployed</code> 함수를 사용하여 컨트랙트를 배포한 후 트랜잭션을 실행합니다. 1 번째는 트랜잭션 로그에 <code class="highlighter-rouge">Deposit</code> 이벤트를 내보내는 입금입니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Deposit</span> <span class="o">{</span> <span class="nl">from:</span> <span class="err">'</span><span class="mh">0x627306090abab3a6e1400e9345bc60c78a8bef57</span><span class="err">'</span><span class="o">,</span>
  <span class="nl">amount:</span> <span class="nc">BigNumber</span> <span class="o">{</span> <span class="nl">s:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">e:</span> <span class="mi">18</span><span class="o">,</span> <span class="nl">c:</span> <span class="o">[</span> <span class="mi">10000</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div></div>

<p>다음은 출금을 만들기 위해 <code class="highlighter-rouge">withdraw</code> 함수를 사용합니다. 이것은 <code class="highlighter-rouge">Withdrawal</code> 이벤트를 내보냅니다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Withdrawal</span> <span class="o">{</span> <span class="nl">to:</span> <span class="err">'</span><span class="mh">0x627306090abab3a6e1400e9345bc60c78a8bef57</span><span class="err">'</span><span class="o">,</span>
  <span class="nl">amount:</span> <span class="nc">BigNumber</span> <span class="o">{</span> <span class="nl">s:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">e:</span> <span class="mi">17</span><span class="o">,</span> <span class="nl">c:</span> <span class="o">[</span> <span class="mi">1000</span> <span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
</code></pre></div></div>

<p>이벤트를 컨트랙트 내에서의 커뮤니케이션뿐만 아니라 개발 과정에서의 디버깅에도 매우 유용합니다.</p>


	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<ul class="socials">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/has3ong" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/%ED%95%98%EC%84%B1-%EA%B9%80-145aa21a0/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

	<div class="footer__copyright">
		<span>© 2020 Try</span>
		Has3ong
	</div>

</footer>


	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/index-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>