<!doctype html>

<html class="no-js" lang="en">

<head>


	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	Try

	Index Theme by https://jekyllthemes.io
	Premium + free Jekyll themes for your blog or website.

	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->


	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<!-- Page Info -->
	<link rel="shortcut icon" href="/images/icon.png">
	<title>Docker와 Python Flask 를 이용한 카카오톡 플러스친구 개발 과 배포 -2- – Try</title>
	<meta name="description" content="">

	<!-- Twitter Card -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Docker와 Python Flask 를 이용한 카카오톡 플러스친구 개발 과 배포 -2- – Try">
	<meta name="twitter:description" content="">
	<meta name="twitter:image:src" content="">

	<!-- Facebook OpenGraph -->
	<meta property="og:title" content="Docker와 Python Flask 를 이용한 카카오톡 플러스친구 개발 과 배포 -2- – Try" />
	<meta property="og:description" content="" />
	<meta property="og:image" content="" />

	
	<!-- Font Embed Code -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,500" rel="stylesheet">
	

	<!-- Styles -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	
	<!-- Icons -->
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/solid.js" integrity="sha384-GXi56ipjsBwAe6v5X4xSrVNXGOmpdJYZEEh/0/GqJ3JTHsfDsF8v0YQvZCJYAiGu" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/brands.js" integrity="sha384-0inRy4HkP0hJ038ZyfQ4vLl+F4POKbqnaUB6ewmU4dWP0ki8Q27A0VFiVRIpscvL" crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/fontawesome.js" integrity="sha384-NY6PHjYLP2f+gL3uaVfqUZImmw71ArL9+Roi9o+I4+RBqArA2CfW1sJ1wkABFfPe" crossorigin="anonymous"></script>

	
	<!-- Custom Styles -->
	<style></style>
	

	
	<!-- Analytics Code -->
	
	

	
	<!-- Extra Header JS Code -->
	
	
	
</head>


<body class="loading ajax-loading" data-site-url="http://localhost:4000" data-page-url="/blog/kakaoplus-python2">


	<header class="header">

	<div class="header__content">

		
		<a href="/" class="header__title">
			Try
		</a>
		

		<h1 class="header__tagline">The man who moves a mountain begins by carrying away small stones. - Confucius</h1>

		<div class="menu">
			<div class="menu__toggle js-menu-toggle">
				<div class="menu__toggle__icon"><span></span></div>
			</div>
			<div class="menu__wrap">
				<ul class="menu__list">
					
					<li class="menu__list__item">
						<a href="/about" class="menu__list__item__link">About</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/apache" class="menu__list__item__link">Apache</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/blockchain" class="menu__list__item__link">BlockChain</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/computerscience" class="menu__list__item__link">Computer Science</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/database" class="menu__list__item__link">DataBase</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/devops" class="menu__list__item__link">DevOps</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/imageprocessing" class="menu__list__item__link">Image Processing</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/machinelearning" class="menu__list__item__link">Machine Learning</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/programming" class="menu__list__item__link">Programming</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/softwaremaestro" class="menu__list__item__link">SW Maestro</a>
					</li>
					
					<li class="menu__list__item">
						<a href="/web" class="menu__list__item__link">Web</a>
					</li>
					
				</ul>
			</div>
		</div>

		<div class="projects-menu">
			<ul class="menu__list">
				
			</ul>
		</div>

		<div class="header__lower">

			<ul class="socials">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/has3ong" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/%ED%95%98%EC%84%B1-%EA%B9%80-145aa21a0/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

			<div class="footer__copyright">
				<span>© 2020 Try</span>
				Has3ong
			</div>

		</div>

	</div>

</header>


	<div class="loader"><svg width="120" height="30" viewBox="0 0 120 30" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite" /></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite" /><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite" /></circle></svg></div>

	<div class="page-loader"></div>

	
	<div class="page">

		<div class="page__content" data-page-title="Docker와 Python Flask 를 이용한 카카오톡 플러스친구 개발 과 배포 -2- – Try">

			<section class="intro">

	<div class="wrap">

		<h1>Docker와 Python Flask 를 이용한 카카오톡 플러스친구 개발 과 배포 -2-</h1>
		<p>13 November 2019</p>

	</div>

</section>

<section class="single">

	<div class="wrap">

		<blockquote>
  <p>이전에 Goorm을 사용했는데 Docker를 보안상의 이유로 사용을 제한해 놨습니다. 그래서 부득이하게 Docker로 배포하는 부분만 AWS에서 작업하겠습니다.</p>
</blockquote>

<blockquote>
  <p>또한, 이 포스트를 진행하기전에 Docker Hub에 계정을 만드시면 됩니다.</p>
</blockquote>

<p>이번 포스트에서는 Docker를 이용하여 배포를 해보겠습니다. Docker에 대해서 잘 모르시는 분들은 <a href="/docker-introduction">Docker 포스트</a>을 보고 오시면 되겠습니다.</p>

<p>제일먼저 Docker를 설치해주셔야 합니다.</p>

<h2 id="1-docker-install">1. Docker Install</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get remove docker docker-engine docker.i

$ sudo apt-get install \
apt-transport-https \
ca-certificates \
curl \
software-properties-common

$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

$ sudo add-apt-repository \
 "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
 $(lsb_release -cs) \
 stable"
 
$ sudo apt-get update
$ sudo apt-get install docker-ce

# 설치 되었는지 확인
$ docker version

Client: Docker Engine - Community
 Version:           19.03.4
 API version:       1.40
 Go version:        go1.12.10
 Git commit:        9013bf583a
 Built:             Fri Oct 18 15:53:51 2019
 OS/Arch:           linux/amd64
 Experimental:      false

Server: Docker Engine - Community
 Engine:
  Version:          19.03.4
  API version:      1.40 (minimum version 1.12)
  Go version:       go1.12.10
  Git commit:       9013bf583a
  Built:            Fri Oct 18 15:52:23 2019
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.2.10
  GitCommit:        b34a5c8af56e510852c35414db4c1f4fa6172339
 runc:
  Version:          1.0.0-rc8+dev
  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657
 docker-init:
  Version:          0.18.0
  GitCommit:        fec3683
</code></pre></div></div>

<h3 id="1-1-dockerfile-작성">1-1. Dockerfile 작성</h3>

<p>그리고 빌드에 사용될 Dockerfile을 작성해줍니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM ubuntu:latest
MAINTAINER your_name "khsh5592"
RUN apt-get update -y
RUN apt-get install python3.6 -y
RUN apt-get install -y python3-pip python-dev build-essential
COPY . /app
RUN ls -la /app/*
WORKDIR /app
RUN pip3 install -r requirements.txt
ENTRYPOINT ["python3"]
CMD ["application.py"]
</code></pre></div></div>

<h3 id="1-2-requirementstxt-작성">1-2. requirements.txt 작성</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip freeze &gt; requirements.txt
</code></pre></div></div>

<p>명령어를 이용해서 python package 정보가 담겨있는 파일을 만들어줍니다. 그러면 쓸데 없는 package들이 많이 들어 있을텐데 Flask 제외하고 전부 지워버리겠습니다.</p>

<blockquote>
  <p>requirements.txt</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flask==1.1.1
</code></pre></div></div>

<h3 id="1-3-docker-로그인">1-3. Docker 로그인</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: khsh5592
Password:
WARNING! Your password will be stored unencrypted in /home/vagrant/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store

Login Succeeded
</code></pre></div></div>

<h3 id="1-4-docker-build">1-4. Docker Build</h3>

<p>Build하기 전 파일 목록들</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls
Dockerfile  app.py  requirements.txt
</code></pre></div></div>

<p>Docker Build</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker build -t khsh5592/suwon-kakaoplus:0.0 .
</code></pre></div></div>

<p>만들어진 모습</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker images
REPOSITORY                 TAG                 IMAGE ID            CREATED              SIZE
khsh5592/suwon-kakaoplus   0.0                 4671f6d943f4        43 seconds ago       547MB
</code></pre></div></div>

<h3 id="1-5-docker-push-to-hub">1-5. Docker Push to Hub</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker push khsh5592/suwon-kakaoplus:0.0
</code></pre></div></div>

<blockquote>
  <p>Docker Hub Repository</p>
</blockquote>

<p><img src="https://user-images.githubusercontent.com/44635266/68525352-f05b5200-0313-11ea-9f31-cc2af1471933.png" alt="image" /></p>

<p>이 Docker Hub 에 올라간 image 는 아래 명령어를 통해 다시 다른환경에서 가져와서 사용할 수 있습니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull khsh5592/suwon-kakaoplus:0.0
</code></pre></div></div>

<h2 id="2-aws-port-열기">2. AWS Port 열기</h2>

<p>이대로 Docker 를 실행시켜도 상관없지만 AWS에 EC2 포트는 막혀있기 때문에 열어 주어야 합니다.</p>

<p>해당 방법은 <a href="https://carfediem-is.tistory.com/9">AWS http 포트 열기</a> 포스트를 참고하셔서 8888 포트를 열어주시면 되겠습니다.</p>

<h2 id="3-docker-container-배포">3. Docker Container 배포</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker run -p 8888:8888 khsh5592/suwon-kakaoplus:0.0
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:8888/ (Press CTRL+C to quit)
 
$ docker ps
CONTAINER ID        IMAGE                          COMMAND                  CREATED             STATUS              PORTS                    NAMES
b1be793e81aa        khsh5592/suwon-kakaoplus:0.0   "python3 application…"   2 seconds ago       Up 1 second         0.0.0.0:5000-&gt;5000/tcp   compassionate_gagarin
</code></pre></div></div>

<h3 id="3-1-작동-확인">3-1. 작동 확인</h3>

<p>http://52.78.63.229:8888/keyboard 먼저 GET을 확인하기 위해 AWS Instance 주소와 포트입력해서 접속해보겠습니다.</p>

<blockquote>
  <p>Chrome</p>
</blockquote>

<p><img src="https://user-images.githubusercontent.com/44635266/68695706-ddb87580-05be-11ea-8d01-cc3c8115d543.png" alt="image" /></p>

<p>정상적으로 작동합니다.</p>

<p>이제 카카오 플러스 친구와 연동을 해보겠습니다.</p>

<p><img src="https://user-images.githubusercontent.com/44635266/68695710-dee9a280-05be-11ea-9e6e-85e62ceeead5.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/44635266/68695713-e01acf80-05be-11ea-8b3d-a05cea5fc86c.png" alt="image" /></p>

<p>잘 작동하네요. 여기서 마무리 지을게요.</p>

<blockquote>
  <p>Log</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run -p 8888:8888 khsh5592/suwon-kakaoplus:0.0
 * Serving Flask app "app" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:8888/ (Press CTRL+C to quit)
211.214.14.153 - - [12/Nov/2019 17:37:28] "GET /keyboard HTTP/1.1" 200 -
211.214.14.153 - - [12/Nov/2019 17:37:28] "GET /favicon.ico HTTP/1.1" 404 -
219.249.231.41 - - [12/Nov/2019 17:39:13] "POST /message HTTP/1.1" 200 -
</code></pre></div></div>

<p>구름에서 Docker 가 막혀있는걸 너무 늦게 깨달았습니다. 그래서 AWS로 변화해서 혼선을 주어 죄송합니다.</p>

<p>긴 포스트 읽어주셔서 감사합니다.</p>



	</div>

</section>

		</div>

	</div>


	<footer class="footer">

	<ul class="socials">
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://github.com/has3ong" target="_blank" class="socials__item__link" title="Github">
			<i class="fab fa-github" aria-hidden="true"></i>
		</a>
	</li>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<li class="socials__item">
		<a href="https://www.linkedin.com/in/%ED%95%98%EC%84%B1-%EA%B9%80-145aa21a0/" target="_blank" class="socials__item__link" title="Linkedin">
			<i class="fab fa-linkedin" aria-hidden="true"></i>
		</a>
	</li>
	
	
</ul>

	<div class="footer__copyright">
		<span>© 2020 Try</span>
		Has3ong
	</div>

</footer>


	<!-- Javascript Assets -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="/js/index-min.js"></script>

	
	<!-- Extra Footer JS Code -->
	
	


</body>

</html>